(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{751:function(s,n,a){s.exports=a.p+"assets/img/docker_ci_04.53b0df91.png"},895:function(s,n,a){"use strict";a.r(n);var t=a(21),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"基于-docker-gitlab-gitlab-runner-搭建完整的自动化-ci-cd-流程-linux-三"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基于-docker-gitlab-gitlab-runner-搭建完整的自动化-ci-cd-流程-linux-三"}},[s._v("#")]),s._v(" 基于 Docker（gitlab, gitlab-runner） 搭建完整的自动化 CI，CD 流程（Linux）（三）")]),s._v(" "),n("h2",{attrs:{id:"脚摸脚通过-gitlab-ci-yml-实现-流水线自动打包部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#脚摸脚通过-gitlab-ci-yml-实现-流水线自动打包部署"}},[s._v("#")]),s._v(" 脚摸脚通过 gitlab-ci.yml 实现 流水线自动打包部署")]),s._v(" "),n("p",{staticClass:"date"},[s._v("2022/06/22 15:41:20 \n"),n("span",{staticClass:"leancloud_visitors",attrs:{id:"/blog/tool/DockerCI_03.html"}},[n("i",{staticClass:"shni shn-eye-fill"}),s._v(" "),n("i",{staticClass:"leancloud-visitors-count"})])]),s._v(" "),n("p",[s._v("以我自己的 "),n("span",{staticClass:"text-green"},[s._v("ubuntu22.04")]),s._v(" 版本为例")]),s._v(" "),n("h3",{attrs:{id:"在项目根目录下创建一个-gitlab-ci-yml-文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在项目根目录下创建一个-gitlab-ci-yml-文件"}},[s._v("#")]),s._v(" 在项目根目录下创建一个 .gitlab-ci.yml 文件")]),s._v(" "),n("p",[s._v("总共四步，")]),s._v(" "),n("ul",[n("li",[s._v("setup:   设置；提前进行一些操作，比如提前安装包，我这里没有必要就没有写，但是保留了这个步骤")]),s._v(" "),n("li",[s._v("install: 安装项目包")]),s._v(" "),n("li",[s._v("build:   打包项目")]),s._v(" "),n("li",[s._v("deploy:  部署项目")])]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("16.15.0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 公共模板定义")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v(".template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&templateDef")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" release\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" test\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("CI_COMMIT_REF_SLUG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node_modules/\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" dist\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义 CI/CD 的阶段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" setup\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" install\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 'setup' 阶段：安装 pnpm 和 http-server")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("setup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*templateDef")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" setup\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm config set registry https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry.npm.taobao.org\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 'install' 阶段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_install")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*templateDef")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm config set registry https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry.npm.taobao.org\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm install\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 'build' 阶段")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*templateDef")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm config set registry https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry.npm.taobao.org\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run build\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" dist/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 'deploy' 阶段,为了启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("19.03.12\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*templateDef")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("19.03.12"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dind\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t appimages .\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "Existing containers'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('"\n        '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker ps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("a\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" if "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" $(docker ps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("aq "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("filter name=app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container) "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v('; then\n          echo "Removing existing container'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v('";\n          docker rm '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('container;\n          else\n          echo "No existing container found.";\n          fi\n        '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "Running new container'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("...")]),s._v('"\n        '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("80 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("name app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container appimages\n\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dependencies")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" job_build\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br")])]),n("h3",{attrs:{id:"在项目根目录下创建-nginx-conf-文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在项目根目录下创建-nginx-conf-文件"}},[s._v("#")]),s._v(" 在项目根目录下创建 nginx.conf 文件")]),s._v(" "),n("p",[s._v("把这个文件复制到容器内作为 nginx 配置文件，写入以下内容")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n  #端口\n  listen 80; \n  server_name localhost;\n\n  #charset koi8-r;\n  access_log /var/log/nginx/host.access.log main;\n  error_log /var/log/nginx/error.log error;\n\n  #配置 vue 路由 history模式\n  location / {\n    root /usr/share/nginx/html;\n    try_files $uri $uri/ /index.html;\n  }\n\n  #error_page 404 /404.html;\n  # redirect server error pages to the static page /50x.html\n  #\n  error_page 500 502 503 504 /50x.html;\n  location = /50x.html {\n    root /usr/share/nginx/html;\n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h3",{attrs:{id:"在项目根目录下创建-dockerfile-文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在项目根目录下创建-dockerfile-文件"}},[s._v("#")]),s._v(" 在项目根目录下创建 Dockerfile 文件")]),s._v(" "),n("p",[s._v("runner 会根据这个文件创建一个 docker 镜像，文件写入内容如下")]),s._v(" "),n("div",{staticClass:"language-Dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" dist/ /usr/share/nginx/html/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" nginx.conf /etc/nginx/conf.d/default.conf")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("然后上传文件到 gitlab，会自动促发流水线流程，如果出现链接问题，进入 gitlab-runner 容器按照下图修改一下配置")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 gitlab-runner 容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" gitlab-runner /bin/bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改 runner 的配置项目")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/gitlab-runner/config.toml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("span",{staticClass:"text-red"},[s._v("PS：这里你之前使用的是那个runner就修改那个runner,我的图片中有2个 runner 是因为我为了添加截图重新注册了一个 runner")]),s._v(" "),n("img",{attrs:{src:a(751),alt:"图片"}})]),n("div",{staticClass:"image-name"},[s._v("图片1：config.toml 配置")]),n("p"),s._v(" "),n("h3",{attrs:{id:"访问部署好的项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问部署好的项目"}},[s._v("#")]),s._v(" 访问部署好的项目")]),s._v(" "),n("p",[s._v("输入网址 "),n("code",[s._v("${url}:8080")]),s._v(" 就可以访问你刚才部署的项目,8080 是 gitlab-ci.yml 中的 depoly 步骤配置的端口映射")]),s._v(" "),n("h3",{attrs:{id:"gitlab-ci-yml-参数配置说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-yml-参数配置说明"}},[s._v("#")]),s._v(" gitlab-ci.yml 参数配置说明")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("script 被 runner 执行的 shell script\nafter_script 在 job 之后执行的脚本\nallow_failure 是否允许 job 失败\nartifacts 在 job 成功后将一个文件列表或目录列表制成制品上传\nbefore_script 在 job 之前执行的脚本\ncache 缓存在随后的 job 的一些文件、目录\ncoverage 代码覆盖率设置\ndependencies 依赖某个 job 的制品并下载到当前的 job 中\nenvironment job 依赖的环境变量\nexcept 限制那些情况 job 不会被触发\nextends job 的继承的配置项\nimage 依赖的 Docker 镜像\ninclude 运行 job 包含额外的 yml 文件\ninterruptible 定义当作业因较新的运行而变得冗余时是否可以取消。\nonly 限制 job 何时可以被触发\npages 上传 job 的结果到 GitLab Pages\nparallel 一个 job 应该并行运行多少个实例。\nrelease 通知 runner 生成一个 release\nresource_group 限制 job 的并发性\nretry 是否重试 重试几次\nrules 与 only/except 类似，限制 job 的调起\nservices 使用 Docker 镜像服务\nstage 阶段\ntags 选择 runner 的 tag\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" 超时\ntrigger 定义下游 pipelines 触发器\nvariables 定义 job 级别的变量\nwhen 何时触发任务\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("base-valine"),s._v(" "),n("el-backtop",{attrs:{"visibility-height":0}})],1)}),[],!1,null,null,null);n.default=e.exports}}]);